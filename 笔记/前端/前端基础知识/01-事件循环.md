# 事件循环

## 简介

事件循环是浏览器的核心原理，没有事件循环浏览器跑不起来

 事件循环与计时器、promise、ajax、node都有关联

讲事件循环之前需要先了解浏览器的进程模型

## 浏览器的进程模型

### 进程

概念：程序运行需要有自己的专属内存空间，可以把这块内存空间简单的理解为进程

每个应用至少有一个进程，进程之间相互独立，即使要通信，也需要双方同意

### 线程

概念：处理器任务调度和执行的基本单位

一个进程至少有一个线程，所以在进程开启后会自动创建一个线程来运行代码，该线程称之为主线程

如果程序需要同时执行多块代码，主线程就会启动更多的线程来执行代码

### 浏览器的进程线程

**浏览器是一个多进程多线程的应用程序**：浏览器内部工作极其复杂，为了避免相互影响、为了减少连环崩溃的几率，当启动浏览器后，它会自动启动多个进程

对于前端人员来说，最重要的三个进程就是：浏览器进程、网络进程、渲染进程

<img src=".\image\事件循环_浏览器的进程模型_任务管理器.png" alt="事件循环_浏览器的进程模型_任务管理器" style="zoom: 50%;" />

#### 浏览器进程

负责页面展示（标签页名称、后退前进按钮、网址栏、导航栏、书签栏等）、用户交互（鼠标滚轮、键盘事件、鼠标时间等）、子进程管理（管理网络进程、渲染进程等）

#### 网络进程

负责加载网络资源

#### 渲染进程

渲染进程启动后，会开启一个**渲染主线程**，主要负责执行HTML、CSS、JS代码

默认情况下，浏览器会为每个标签页开启一个新的渲染进程，以保证不同的标签页之间互不影响

## 渲染主线程

渲染主线程是浏览器中最繁忙的线程，其需要处理：解析HTML、CSS、计算样式、布局、处理图层、每秒把页面画60次、执行全局JS代码、执行事件处理函数、执行计时器的回调函数

> 思考：为什么渲染进程不适用多个线程来处理这些事情
>
> answer：没有办法多线程

渲染主线程要处理如此多事情，因此遇到了调度问题，如主线程正在执行一个JS函数，但还未执行完时用户点击了一个按钮
解决办法：排队



w3c里面叫event loop，在chrome里面源码称其为message loop，因此消息循环和事件循环是一个东西

1、在最开始的时候，渲染主线程会进入一个无限循环